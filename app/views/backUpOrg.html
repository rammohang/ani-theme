<div data-ng-include="'views/navbar.html'"></div>
<div>
	 <!--  ROW BEGIN -->
	<div class="row">
		<div class="col-md-2"></div>
		<div class="col-md-4">
			<div class="form-group">
    			<label for="proxyName">Backup Organization</label>
    			<p>
		        	<select ng-model="organization" name="organization" id="organization" ng-change="changeOrg()" ng-options="org for org in orgs">
		          		<option value="">Select Organization</option>
		        	</select>
		        	<input ng-model="orgText" id="other_organization" name="other_organization" type="text" placeholder="type organization name" ng-show="showOther" />
		      	</p>
			</div>
			<div class="form-group">
				<button class="btn btn-primary" ng-click="backUpOrg()" >Backup</button>
			</div>
		</div>
		<div class="col-md-4">
			<div class="form-group">
    			<label for="proxyName">Schedule Organization Backup</label>
    			<p>
		        	<select ng-model="scheduledOrg" name="organization" id="organization" ng-click="changeScheduleOrg()" ng-options="org for org in userDetails.organizations">
		          		<option value="">Select Organization</option>
		        	</select>
		        	<select ng-model="periodicity" name="periodicity" id="periodicity" ng-options="periodicity for periodicity in periodicities">
		          		<option value="">Select Periodicity</option>
		        	</select>
		      	</p>
			</div>
			<div class="form-group">
				<button class="btn btn-warning" ng-click="seeAllSchedules()" >See All Schedules</button>
				<button class="btn btn-primary" ng-click="saveBackupSchedule()" >Schedule Backup</button>
			</div>
		</div>
		<div class="col-md-2"></div>
	</div>
	<!--  ROW END -->
		
	<div class="backupOrgContainer">
		<div class="row">
			<!--  column1 -->
			<div class="col-md-2"></div>
			<div class="col-md-8" ng-if="orgHis">
				<table class="table table-hover">
					<tr>
						<th>Backedup On</th>
						<th>Organization</th>
						<th>Time Taken(sec)</th>
						<th>Status</th>
						<th>Console</th>
						<th>Action</th>
					</tr>
					<tr ng-repeat="item in orgHis | pagination: curPage * pageSize | limitTo: pageSize">
						<td>{{item.cts | date:'medium'}}</td>
						<td>{{item.organization}}</td>
						<td>{{item.backUpTimeTaken}}</td>
						<td>{{item.status}}</td>
						<td>
							<button class="btn btn-warning btn-xs" ng-click="viewDetailedStatus(item)" ng-disabled="disableButton(item.disableButtons)">Console</button>
						</td>
						<td>
							<div class="row acmAction">
								<div class="col-sm-6 col-md-6 restoreBtn"><button class="btn btn-success btn-xs" ng-click="confirmAction(item,'restore')" ng-disabled="disableButton(item.disableButtons)">Restore</button><img ng-if="item.restoreLoader" class="spinner16X16" ng-src="../images/16x16-spinner.gif"/></div>
								<div class="col-sm-6 col-md-6 deleteBtn" ><button class="btn btn-danger btn-xs" ng-click="confirmAction(item,'delete')" ng-disabled="disableButton(item.disableButtons)">Delete</button><img ng-if="item.deleteLoader" class="spinner16X16" ng-src="../images/16x16-spinner.gif"/></div>
							</div>
						</td>
					</tr>    
				</table>
				<ul class="pagination-controle pagination">
					<li>
						<button type="button" class="btn btn-primary" ng-disabled="curPage == 0" ng-click="curPage=curPage-1"> &lt; PREV</button>
					</li>
					<li>
						<span>Page {{curPage + 1}} of {{ numberOfPages() }}</span>
					</li>
					<li>
						<button type="button" class="btn btn-primary" ng-disabled="curPage >= orgHis.length/pageSize - 1" ng-click="curPage = curPage+1">NEXT &gt;</button>
					</li>
				</ul>
			</div>
			<div class="col-md-4"></div>
		</div>
	</div>
</div>

<mymodal class="statusModal" title="Backup Status" visible="showModal">
   <div class="statusContainer">
		<div class="row">
			
			<div class="col-sm-4 col-md-4" >
		    	<h4 class="info">Proxies</h4>
		    	<div class="table-responsive">
				  <table class="table table-bordered">
				    	<thead>
				    		<tr>
				    			<td class="danger">Proxy</td>
				    			<td class="danger">(Env, Rev)</td>
				    		</tr>
				    	</thead>
				    	<tbody>
				    		<tr ng-repeat="proxy in proxyInfo">
				    			<td>{{proxy.proxyName}}</td>
				    			<td><span ng-repeat="env in proxy.environments">({{env.environment}}, {{env.revision}}) {{$last ? '' : ', '}}</span></td>
				    		</tr>
				    	</tbody>
				  </table>
				</div>
		    </div>
		
			<div class="col-sm-8 col-md-8" >
		    	<h4 class="info">Resources</h4>
		    	<div class="table-responsive">
				  <table class="table table-bordered">
				    	<thead>
				    		<tr>
				    			<td class="info">Env</td>
				    			<td class="info">Caches</td>
				    			<td class="info">KV</td>
				    			<td class="info">Target Servers</td>
				    			<td class="info">Virtual Hosts</td>
				    		</tr>
				    	</thead>
				    	<tbody>
				    		<tr ng-repeat="resource in resourceInfo">
				    			<td>{{resource.envName}}</td>
				    			<td><span ng-repeat="cache in resource.CACHES"> {{cache}} {{$last ? '' : ', '}}</span></td>
				    			<td><span ng-repeat="kv in resource.KV">{{kv}} {{$last ? '' : ', '}}</span> </td>
				    			<td><span ng-repeat="ts in resource.TARGETSERVERS">{{ts}} {{$last ? '' : ', '}}</span></td>
				    			<td><span ng-repeat="vh in resource.VIRTUALHOSTS">{{vh}} {{$last ? '' : ', '}}</span></td>
				    		</tr>
				    	</tbody>
				  </table>
				</div>
		    </div>
		    
		</div>
		<div class="row">
		
			<div class="col-sm-4 col-md-4" >
		    	<h4 class="info">Apps</h4>
		    	<div class="table-responsive">
				  <table class="table table-bordered">
				    	<thead>
				    		<tr>
				    			<td class="success">Apps</td>
				    		</tr>
				    	</thead>
				    	<tbody>
				    		<tr ng-repeat="app in appsInfo">
				    			<td>{{app}}</td>
				    		</tr>
				    	</tbody>
				  </table>
				</div>
			</div>
		
		
		    <div class="col-sm-4 col-md-4" >
		    	<h4 class="info">Products</h4>
		    	<div class="table-responsive">
				  <table class="table table-bordered">
				    	<thead>
				    		<tr>
				    			<td class="warning">Products</td>
				    		</tr>
				    	</thead>
				    	<tbody>
				    		<tr ng-repeat="product in productsInfo">
				    			<td>{{product}}</td>
				    		</tr>
				    		<tr ng-repeat="sproduct in skippedProductsInfo">
				    			<td>{{sproduct}}</td>
				    		</tr>
				    	</tbody>
				  </table>
				</div>
			</div>
		    
		   
		    <div class="col-sm-4 col-md-4" >
		    	<h4 class="info">Developers</h4>
		    	<div class="table-responsive">
				  <table class="table table-bordered">
				    	<thead>
				    		<tr>
				    			<td class="danger">Developers</td>
				    		</tr>
				    	</thead>
				    	<tbody>
				    		<tr ng-repeat="developer in developersInfo">
				    			<td>{{developer}}</td>
				    		</tr>
				    	</tbody>
				  </table>
				</div>
		    </div>
		    
		</div>
		<!-- SKIPPED -->
		<div class="row">
		
		
	<hr>	
		
		    <div class="col-sm-4 col-md-4" >
		    	<h4 class="info">Products that were not backedup</h4>
		    	<div class="table-responsive">
				  <table class="table table-bordered">
				    	<thead>
				    		<tr>
				    			<td class="warning">Products</td>
				    		</tr>
				    	</thead>
				    	<tbody>
				    		<tr ng-repeat="sproduct in skippedProductsInfo">
				    			<td>{{sproduct}}</td>
				    		</tr>
				    	</tbody>
				  </table>
				</div>
			</div>
		    <div class="col-sm-8 col-md-8" >
		    	<h4 class="info">Resources that were not backedup</h4>
		    	<div class="table-responsive">
				  <table class="table table-bordered">
				    	<thead>
				    		<tr>
				    			<td class="info">Env</td>
				    			<td class="info">Caches</td>
				    			<td class="info">KV</td>
				    			<td class="info">Target Servers</td>
				    			<td class="info">Virtual Hosts</td>
				    		</tr>
				    	</thead>
				    	<tbody>
				    		<tr ng-repeat="resource in resourceInfo">
				    			<td>{{resource.envName}}</td>
				    			<td><span ng-repeat="cache in resource.SKIPPEDCACHES"> {{cache}} {{$last ? '' : ', '}}</span></td>
				    			<td><span ng-repeat="kv in resource.SKIPPEDKV">{{kv}} {{$last ? '' : ', '}}</span> </td>
				    			<td><span ng-repeat="ts in resource.SKIPPEDTARGETSERVERS">{{ts}} {{$last ? '' : ', '}}</span></td>
				    			<td><span ng-repeat="vh in resource.SKIPPEDVIRTUALHOSTS">{{vh}} {{$last ? '' : ', '}}</span></td>
				    		</tr>
				    	</tbody>
				  </table>
				</div>
		    </div>
		   
		 
		</div>
	</div>
	
 </mymodal>
 
 <mymodal class="schedulesModal" title="Scheduled Backups" visible="showBackups">
 	<table class="table table-bordered">
    	<thead>
    		<tr>
    			<td class="info">Organization</td>
    			<td class="info">Periodicty</td>
    			<td class="info">Actions</td>
    		</tr>
    	</thead>
    	<tbody>
    		<tr ng-repeat="backupSchedule in backupSchedules">
    			<td>{{backupSchedule.organization}}</td>
    			<td>{{backupSchedule.periodicity}}</td>
    			<td><button class="btn btn-danger btn-xs" ng-click="deleteScheduleOrg(backupSchedule.id)" >Delete</button></td>
    		</tr>
    	</tbody>
  	</table>
 </mymodal>
